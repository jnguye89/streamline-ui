<div class="container">
  <!-- Top: 3/4 height viewer -->
  <div class="viewer" *ngIf="threads$ | async as threads">
    <ng-container *ngIf="threads?.length; else empty">
      <div class="stage">
        <ng-container *ngFor="let t of threads; let i = index; trackBy: trackById">
          <mat-card class="thread-card center-align" appearance="outlined" *ngIf="i === currentIndex"
            [@slideH]="{ value: direction, params: animParams }">
            <mat-card-header class="center-align">
              <mat-card-title>{{ t.threadItem }}</mat-card-title>
            </mat-card-header>
            <br /><br />
            <mat-divider></mat-divider>
            <br /><br />
            <mat-card-content class="thread-content center-align">
              {{ t.user }}<br />
              {{ t.createdAt | date }}
            </mat-card-content>
          </mat-card>
        </ng-container>
      </div>

      <!-- Nav -->
      <button mat-icon-button class="nav prev" (click)="prev(threads.length)" aria-label="Previous">
        <mat-icon>chevron_left</mat-icon>
      </button>
      <button mat-icon-button class="nav next" (click)="next(threads.length)" aria-label="Next">
        <mat-icon>chevron_right</mat-icon>
      </button>
      <div class="pager">{{ currentIndex + 1 }} / {{ threads.length }}</div>
    </ng-container>
  </div>


  <!-- Bottom: 1/4 height composer -->
  <ng-container *ngIf="isAuthenticated$ | async; else loginscreen">
    <form class="composer" (ngSubmit)="submit()">
      <div class="textarea-box">
        <mat-form-field class="field" appearance="outline">
          <textarea matInput name="text" [(ngModel)]="text" placeholder="Write a threadâ€¦" maxlength="255"></textarea>
          <mat-hint>{{ (text?.length || 0) }} / 255</mat-hint>
        </mat-form-field>
      </div>

      <div class="actions">
        <button mat-flat-button color="primary" type="submit" [disabled]="!canSubmit">
          Submit
        </button>
      </div>
    </form>
  </ng-container>
  <ng-template #empty>
    <div class="empty">No threads yet.</div>
  </ng-template>
  <ng-template #loginscreen>
    <button mat-button (click)="login()">Login to add your own</button>
  </ng-template>
</div>